<p-card *transloco="let t">
  <ng-template pTemplate="header">
    <h2>{{ t('page.Push Notifications') }}</h2>
  </ng-template>

  <!-- Status Info -->
  <section>
    <h3>{{ t('Status') }}</h3>
    <dl class="status-grid">
      <div>
        <dt>{{ t('Platform') }}</dt>
        <dd>{{ platformType }}</dd>
      </div>
      <div>
        <dt>{{ t('Permission') }}</dt>
        <dd [class.granted]="notificationService.permissionGranted()" [class.denied]="!notificationService.permissionGranted()">
          {{ permissionStatus }}
        </dd>
      </div>
      <div>
        <dt>{{ t('Supported') }}</dt>
        <dd>{{ notificationService.isSupported() ? t('Yes') : t('No') }}</dd>
      </div>
      <div>
        <dt>{{ t('notification.Unread Count') }}</dt>
        <dd>{{ notificationService.unreadCount() }}</dd>
      </div>
    </dl>
  </section>

  <!-- Test Notifications -->
  <section>
    <h3>{{ t('page.Test Notifications') }}</h3>
    <p>{{ t('page.Send predefined notifications to test the system') }}</p>
    @if (!authService.isAuthenticated()) {
      <p-message severity="info" [text]="t('auth.Register or log in to access all features')" />
    }

    @for (notification of predefinedNotifications; track notification.id) {
      <article class="notification-test-card">
        <div class="notification-preview">
          <strong>{{ getTitle(notification) }}</strong>
          <p>{{ getBody(notification) }}</p>
        </div>
        <div class="notification-actions">
          <p-button
            [label]="t('page.Send Local')"
            icon="pi pi-bell"
            (onClick)="sendLocalNotification(notification)"
            [severity]="getSeverity(notification)"
            size="small"
          />
          <p-button
            [label]="t('page.Broadcast')"
            icon="pi pi-megaphone"
            (onClick)="sendServerNotification(notification)"
            [loading]="loading()"
            [severity]="getSeverity(notification)"
            size="small"
            [outlined]="true"
            [disabled]="!authService.isAuthenticated()"
          />
        </div>
      </article>
    }

    @if (localNotificationStatus()) {
      <p class="status-message local">{{ localNotificationStatus() }}</p>
    }

    @if (serverNotificationStatus()) {
      <p class="status-message server">{{ serverNotificationStatus() }}</p>
    }
  </section>

  <!-- Info Section -->
  <section>
    <h3>{{ t('page.How It Works') }}</h3>
    <ul class="bulleted">
      <li>
        <strong>{{ t('page.Local Notification') }}:</strong>
        {{ t('page.Sends a notification only to your current browser/device. Uses the NotificationService directly.') }}
      </li>
      <li>
        <strong>{{ t('page.Server Broadcast') }}:</strong>
        {{ t('page.Sends a notification via GraphQL to the server, which broadcasts it to ALL connected clients via WebSocket.') }}
      </li>
      <li>
        <strong>{{ t('page.Platform Detection') }}:</strong>
        {{ t('page.Tauri apps use native OS notifications. Web/PWA uses browser notifications via Service Worker.') }}
      </li>
    </ul>
  </section>
</p-card>
