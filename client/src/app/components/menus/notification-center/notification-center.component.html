<app-dialog-menu position="top-right" width="38rem" *transloco="let t">
  <!-- Trigger: Notification Center Button -->
  <span
    menu-trigger
    class="notification-center-button"
    [attr.title]="t('nav.Notifications')"
  >
    <i class="pi pi-bell"></i>
    @if (notificationService.unreadCount() > 0) {
      <span class="notification-badge">{{ notificationService.unreadCount() }}</span>
    }
  </span>

  <!-- Menu Content: Notification Center -->
  <div menu-content>
      <div menu-header class="notification-center-header">
        <h3>{{ t('nav.Notifications') }}</h3>
        <div class="notification-center-actions">
          @if (notificationService.unreadCount() > 0) {
            <p-button
              (onClick)="markAllAsRead()"
              [label]="t('notification.Mark all read')"
              [text]="true"
              size="small"
              [attr.aria-label]="t('notification.Mark all read')"
            />
          }
          @if (notificationService.notifications().length > 0) {
            <p-button
              (onClick)="clearAll()"
              [label]="t('notification.Clear all')"
              [text]="true"
              size="small"
              [attr.aria-label]="t('notification.Clear all')"
            />
          }
        </div>
        <hr />
      </div>

      <div menu-body appScrollIndicator class="notification-center-body">
        @if (notificationService.notifications().length === 0) {
          <div class="notification-empty">
            <i class="pi pi-bell"></i>
            <p>{{ t('notification.No notifications') }}</p>
          </div>
        } @else {
          <div class="notification-list">
            @for (notification of notificationService.notifications(); track notification.id) {
              <p-card
                [styleClass]="'notification-item' + (!notification.read ? ' unread' : '')"
                [attr.aria-label]="getTitle(notification) + '. ' + getBody(notification) + '. ' + (notification.timestamp | relativeTime) + '. ' + (notification.read ? t('a11y.Read') : t('a11y.Unread'))"
              >
                <ng-template pTemplate="header">
                  <div class="notification-header">
                    <div class="notification-content">
                      @if (notification.icon) {
                        <img [src]="notification.icon" alt="" class="notification-icon" width="64" height="64" loading="lazy" />
                      }
                      <div class="notification-text">
                        <div class="notification-title">{{ getTitle(notification) }}</div>
                        <app-relative-time
                          class="notification-time"
                          [timestamp]="notification.timestamp"
                        />
                      </div>
                    </div>
                    <p-button
                      icon="pi pi-trash"
                      (onClick)="deleteNotification($event, notification.id)"
                      [text]="true"
                      [rounded]="true"
                      severity="secondary"
                      size="small"
                      [attr.aria-label]="t('notification.Delete notification')"
                    />
                  </div>
                </ng-template>
                <div class="notification-body">{{ getBody(notification) }}</div>
              </p-card>
            }
          </div>
        }
      </div>

    @if (!notificationService.permissionGranted()) {
      <div menu-footer class="notification-center-footer">
        <p-button
          (onClick)="requestPermission()"
          [label]="t('notification.Enable Notifications')"
          [attr.aria-label]="t('notification.Enable Notifications')"
          styleClass="w-full"
        />
      </div>
    }
  </div>
</app-dialog-menu>
